<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single Cell Sample Size Calculation • scClassify</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Single Cell Sample Size Calculation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">scClassify</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Classify Your Cells
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/pretrainedModel.html">Prediction using pretrained model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Build Your Own Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/scClassify.html">scClassify Model Building and Prediction</a>
    </li>
    <li>
      <a href="../../articles/webOnly/sampleSizeCal.html">Sample size learning</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Pretrained Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webOnly/Tasic2016_mouseNeuronal.html">Tasic (2016) (Mouse neuronal)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Tasic2018_mouseNeuronal.html">Tasic (2018) (Mouse neuronal)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Hrvatin_mouseNeuronal.html">Hrvatin (Mouse neuronal)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Cohen_mouseLung.html">Cohen (Mouse lung)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Park_mouseKidney.html">Park (Mouse kidney)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/MacParlandres_humanLiver.html">MacParland (Human Liver)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Aizarani_humanLiver.html">Aizarani (Human Liver)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Baron_humanPancreas.html">Baron (Human Pancreas)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Muraro_humanPancreas.html">Muraro (Human Pancreas)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Lawlor_humanPancreas.html">Lawlor (Human Pancreas)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Xin_humanPancreas.html">Xin (Human Pancreas)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Wang_humanPancreas.html">Wang (Human Pancreas)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Segerstolpe_humanPancreas.html">Segerstolpe (Human Pancreas)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Joint_humanPancreas.html">Joint (Human Pancreas)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Joint_humanPBMC.html">Joint (Human PBMC)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/Li_humanMelanoma.html">Li (Human Melanoma)</a>
    </li>
    <li>
      <a href="../../articles/webOnly/TabulaMuris.html">Tabula Muris (Mouse cell atlas)</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://shiny.maths.usyd.edu.au/scClassify/">
    <span class="fa fa-star"></span>
     
    Interactive scClassify shiny app (beta)
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SydneyBioX/scClassify">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Single Cell Sample Size Calculation</h1>
            
      
      
      <div class="hidden name"><code>sampleSizeCal.Rmd</code></div>

    </div>

    
    
<p>This vignette will provide an example of how we can fit a learning curve based on classification accuracies derived from <code>scClassify</code>.</p>
<p>Suppose we have a small pilot reference data, and we would like to use this reference data to build scClassify model. We can construct the learning curve to estimate the number of cells required in a reference dataset to accurately discriminate between two cell types at a given level in the cell type hierarchy.</p>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>Here, we illustrate the learning curve construction with a small example dataset with 4 cell types, with only 980 genes and 674 cells.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scClassify)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(<span class="st">"scClassify_example.rda"</span>)
xin_cellTypes &lt;-<span class="st"> </span>scClassify_example<span class="op">$</span>xin_cellTypes
exprsMat_xin_subset &lt;-<span class="st"> </span>scClassify_example<span class="op">$</span>exprsMat_xin_subset

exprsMat_xin_subset &lt;-<span class="st"> </span><span class="kw">as</span>(exprsMat_xin_subset, <span class="st">"dgCMatrix"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(exprsMat_xin_subset)
<span class="co">#&gt; [1] 980 674</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(xin_cellTypes)
<span class="co">#&gt; xin_cellTypes</span>
<span class="co">#&gt; alpha  beta delta gamma </span>
<span class="co">#&gt;   285   261    49    79</span></code></pre></div>
<p>We can first have a look at the cell type tree constructed by the whole data. The cell type tree has two levels of cell type labels:</p>
<ul>
<li>
<strong>First level</strong>: “gamma_delta_beta”, “alpha”</li>
<li>
<strong>Second level</strong>: “gamma”, “delta”, “beta”, “alpha”</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(<span class="st">"trainClassExample.rda"</span>)
trainClassExample
<span class="co">#&gt; Class: scClassifyTrainModel </span>
<span class="co">#&gt; Model name: training </span>
<span class="co">#&gt; Feature selection methods: limma </span>
<span class="co">#&gt; Number of cells in the training data: 674 </span>
<span class="co">#&gt; Number of cell types in the training data: 4</span>
<span class="kw"><a href="../../reference/plotCellTypeTree.html">plotCellTypeTree</a></span>(trainClassExample<span class="op">@</span>cellTypeTree)</code></pre></div>
<p><img src="sampleSizeCal_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>By default, <code>scClassify</code> will construct the learning curve on the basis of classification accuracies calculated at the bottom level (i.e., second level in the example).</p>
</div>
<div id="learning-curve-construction" class="section level1">
<h1 class="hasAnchor">
<a href="#learning-curve-construction" class="anchor"></a>Learning curve construction</h1>
<p>Next, we can get an accuracy matrix by running <code>runSampleCal</code> function, where the parameter <code>n_list</code> indicates a list of sample sizes (N) that you would like to subsample from the data as the training set, and <code>num_repeat</code> indicates the number of times to repeat this procedure for each <code>N</code>.</p>
<p>For the purpose of illustration, here we set a short length of <code>n_list</code> and a small number of <code>num_repeat</code>. A longer <code>n_list</code> and a larger number of <code>num_repeat</code> is recommended for better learning curve fitting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">2019</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(accMat &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/runSampleCal.html">runSampleCal</a></span>(exprsMat_xin_subset, 
                                   xin_cellTypes,
                                   <span class="dt">n_list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">20</span>, <span class="dv">160</span>, <span class="dv">20</span>), 
                                   <span class="dt">num_repeat =</span> <span class="dv">10</span>, <span class="dt">ncores =</span> <span class="dv">1</span>))</code></pre></div>
<p>After we obtain an accuracy matrix, we can fit the learning curve by using the <code>learningCurve</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/learningCurve.html">learningCurve</a></span>(<span class="dt">accMat =</span> accMat,
                     <span class="dt">n =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(accMat)))</code></pre></div>
<p>Check the parameters estimated from the average accuracy rates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res<span class="op">$</span>model<span class="op">$</span>mean
<span class="co">#&gt; Nonlinear regression model</span>
<span class="co">#&gt;   model: acc ~ I(1/n^(c) * a) + b</span>
<span class="co">#&gt;    data: dat_train</span>
<span class="co">#&gt;                 a.(Intercept) c.log(max(acc) + 0.001 - acc) </span>
<span class="co">#&gt;                       -2.2185                        0.8604 </span>
<span class="co">#&gt;                             b </span>
<span class="co">#&gt;                        0.9680 </span>
<span class="co">#&gt;  residual sum-of-squares: 0.0005507</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of iterations to convergence: 6 </span>
<span class="co">#&gt; Achieved convergence tolerance: 1.49e-08</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res<span class="op">$</span>plot</code></pre></div>
<p><img src="sampleSizeCal_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p>Using <code>getN</code> function, we can also esimate a sample size for future experiments given the accuracy rate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/getN.html">getN</a></span>(res, <span class="dt">acc =</span> <span class="fl">0.93</span>)
<span class="co">#&gt; [1] 113</span></code></pre></div>
</div>
<div id="constructing-learning-curves-based-on-labels-from-higher-level-of-the-cell-type-tree" class="section level1">
<h1 class="hasAnchor">
<a href="#constructing-learning-curves-based-on-labels-from-higher-level-of-the-cell-type-tree" class="anchor"></a>Constructing learning curves based on labels from higher level of the cell type tree</h1>
<p>We can input <code>cellType_tree</code> and specify the level of labels we would like to use to construct the learning curve. Here, we set <code>level = 1</code> to calculate the learning curve for <strong>First level</strong> cell type labels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">2019</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(accMat_level1 &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/runSampleCal.html">runSampleCal</a></span>(exprsMat_xin_subset, 
                                          xin_cellTypes,
                                          <span class="dt">n_list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">20</span>, <span class="dv">160</span>, <span class="dv">20</span>),
                                          <span class="dt">num_repeat =</span> <span class="dv">10</span>,
                                          <span class="dt">cellType_tree =</span> trainClassExample<span class="op">@</span>cellTypeTree,
                                          <span class="dt">level =</span> <span class="dv">1</span>,
                                          <span class="dt">ncores =</span> <span class="dv">1</span>))

res_level1 &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/learningCurve.html">learningCurve</a></span>(accMat_level1,
                            <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(accMat_level1)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res_level1<span class="op">$</span>plot</code></pre></div>
<p><img src="sampleSizeCal_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/sessionInfo">sessionInfo</a></span>()
<span class="co">#&gt; R version 3.6.1 (2019-07-05)</span>
<span class="co">#&gt; Platform: x86_64-apple-darwin15.6.0 (64-bit)</span>
<span class="co">#&gt; Running under: macOS Mojave 10.14.6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib</span>
<span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] scClassify_0.2.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Biobase_2.44.0      viridis_0.5.1       mixtools_1.1.0     </span>
<span class="co">#&gt;  [4] viridisLite_0.3.0   splines_3.6.1       ggraph_1.0.2       </span>
<span class="co">#&gt;  [7] RcppParallel_4.4.3  assertthat_0.2.1    statmod_1.4.32     </span>
<span class="co">#&gt; [10] stats4_3.6.1        yaml_2.2.0          ggrepel_0.8.1      </span>
<span class="co">#&gt; [13] pillar_1.4.2        backports_1.1.5     lattice_0.20-38    </span>
<span class="co">#&gt; [16] glue_1.3.1          limma_3.40.6        digest_0.6.21      </span>
<span class="co">#&gt; [19] polyclip_1.10-0     colorspace_1.4-1    htmltools_0.3.6    </span>
<span class="co">#&gt; [22] Matrix_1.2-17       plyr_1.8.4          pkgconfig_2.0.3    </span>
<span class="co">#&gt; [25] purrr_0.3.2         scales_1.0.0        tweenr_1.0.1       </span>
<span class="co">#&gt; [28] hopach_2.44.0       ggforce_0.3.1       tibble_2.1.3       </span>
<span class="co">#&gt; [31] proxy_0.4-23        mgcv_1.8-28         farver_1.1.0       </span>
<span class="co">#&gt; [34] ggplot2_3.2.1       BiocGenerics_0.31.6 lazyeval_0.2.2     </span>
<span class="co">#&gt; [37] survival_2.44-1.1   magrittr_1.5        crayon_1.3.4       </span>
<span class="co">#&gt; [40] memoise_1.1.0       evaluate_0.14       fs_1.3.1           </span>
<span class="co">#&gt; [43] nlme_3.1-141        MASS_7.3-51.4       segmented_1.0-0    </span>
<span class="co">#&gt; [46] xml2_1.2.2          tools_3.6.1         minpack.lm_1.2-1   </span>
<span class="co">#&gt; [49] stringr_1.4.0       S4Vectors_0.23.25   munsell_0.5.0      </span>
<span class="co">#&gt; [52] cluster_2.1.0       compiler_3.6.1      pkgdown_1.3.0      </span>
<span class="co">#&gt; [55] proxyC_0.1.5        pbmcapply_1.5.0     rlang_0.4.0        </span>
<span class="co">#&gt; [58] grid_3.6.1          rstudioapi_0.10     igraph_1.2.4.1     </span>
<span class="co">#&gt; [61] labeling_0.3        rmarkdown_1.15      gtable_0.3.0       </span>
<span class="co">#&gt; [64] roxygen2_6.1.1      R6_2.4.0            gridExtra_2.3      </span>
<span class="co">#&gt; [67] knitr_1.24          dplyr_0.8.3         commonmark_1.7     </span>
<span class="co">#&gt; [70] rprojroot_1.3-2     desc_1.2.0          stringi_1.4.3      </span>
<span class="co">#&gt; [73] parallel_3.6.1      Rcpp_1.0.2          diptest_0.75-7     </span>
<span class="co">#&gt; [76] tidyselect_0.2.5    xfun_0.9</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#learning-curve-construction">Learning curve construction</a></li>
      <li><a href="#constructing-learning-curves-based-on-labels-from-higher-level-of-the-cell-type-tree">Constructing learning curves based on labels from higher level of the cell type tree</a></li>
      <li><a href="#session-info">Session Info</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Yingxin Lin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
